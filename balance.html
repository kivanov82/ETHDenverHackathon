<html>
  <head>
     <title>Simple MetaMask-ready DAPP.</title>
  </head>
  <body>
  <p>
    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque ut vestibulum diam. Nam varius eros eu dui molestie, et dignissim orci pellentesque. Praesent in ultrices magna. Fusce placerat eu nibh ut maximus. Nulla laoreet diam ac est congue, et varius ligula sollicitudin. Donec eu mi et sem hendrerit rhoncus vitae eu quam. Phasellus dictum congue erat. Etiam rutrum vel est eget mollis. Praesent volutpat turpis mi, id molestie sapien auctor consequat. Aenean laoreet elit ut lacus suscipit, sit amet fringilla orci dictum. Nam eget rhoncus neque. Vestibulum blandit eu ex a mattis.
  </p>
  <div id="meta-mask-required"></div>

  <div id="network"></div>

  <div id="winner"></div>

  <button onclick="callContract()">Vote for 1</button>


  <script>
      const abi = [
          {
              "constant": false,
              "inputs": [
                  {
                      "name": "to",
                      "type": "address"
                  }
              ],
              "name": "delegate",
              "outputs": [],
              "payable": false,
              "stateMutability": "nonpayable",
              "type": "function"
          },
          {
              "constant": true,
              "inputs": [],
              "name": "winningProposal",
              "outputs": [
                  {
                      "name": "_winningProposal",
                      "type": "uint8"
                  }
              ],
              "payable": false,
              "stateMutability": "view",
              "type": "function"
          },
          {
              "constant": false,
              "inputs": [
                  {
                      "name": "toVoter",
                      "type": "address"
                  }
              ],
              "name": "giveRightToVote",
              "outputs": [],
              "payable": false,
              "stateMutability": "nonpayable",
              "type": "function"
          },
          {
              "constant": false,
              "inputs": [
                  {
                      "name": "toProposal",
                      "type": "uint8"
                  }
              ],
              "name": "vote",
              "outputs": [],
              "payable": false,
              "stateMutability": "nonpayable",
              "type": "function"
          },
          {
              "inputs": [
                  {
                      "name": "_numProposals",
                      "type": "uint8"
                  }
              ],
              "payable": false,
              "stateMutability": "nonpayable",
              "type": "constructor"
          }
      ];

      const address = '0x8f00e2d44472642f8d6820d55c8a841e981b072e';

      var MyContract;
      var contractInstance


    // MetaMask injects the web3 library for us.
    window.onload = function() {
        if (typeof web3 === 'undefined') {
            document.getElementById('meta-mask-required').innerHTML = 'You need <a href="https://metamask.io/">MetaMask</a> browser plugin to run this example'
        }

        web3.version.getNetwork((err, netId) => {
            var network = '';
            switch (netId) {
                case "1":
                    network = 'mainnet'
                    break
                case "2":
                    network = 'Morden test network.'
                    break
                case "3":
                    network = 'ropsten test network.'
                    break
                case "4":
                    network = 'Rinkeby test network.'
                    break
                case "42":
                    network = 'Kovan test network.'
                    break
                default:
                    network = 'unknown network.'
            }
            document.getElementById('network').innerHTML = ('Network is: <b>' + network + '</b>');

        })

        MyContract = web3.eth.contract(abi);

        // instantiate by address
        contractInstance = MyContract.at(address);

        var winner = contractInstance.winningProposal(function(error, result){
            if(!error) {
                document.getElementById('winner').innerHTML = ('The winner is: <b>' + result.c[0] + '</b>');
            }
            else
                console.error(error);
        });

        //document.getElementById('winner').innerHTML = ('The winner is: <b>' + winner + '</b>');

    }






    function callContract() {
        // send a transaction to a function
        contractInstance.vote(1, function(error, tx){
            if(!error)
                console.log(tx)
            else
                console.error(error);
        });
    }

  </script>
  </body>
</html>
